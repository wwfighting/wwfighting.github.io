---
layout: post
title:  "自定义View"
comments: true
categories: android
---

* content
{:toc}

## CustomView

  自定 义View属于andorid初级向中级的一个进阶阶段，平时也看过不少自定义View的文章，最近又重新整理

学习了有关android中自定义View的知识点。周末将其记录下来。

## 初识自定义View

  android本身提供了很多基本的控件供开发者使用，但是有的控件的效果往往需要自己重新定义一个View才能实现。

不过系统本身提供的View已经能实现大部分的功能了，不是万不得已不要自定义View。

  废话不多说，来看实现自定义View的过程：

实现自定义View往往分这几类：

  * 大方向上有自定义View和自定义ViewGroup，字面意思很容易理解，一个是自定义控件，比如TextView、Button等，一个是自定义控件容器，

自定义控件容器是用来盛装View的，比如Linearlayout、ScrollView等等。

  1. 自定义View
  2. 自定义ViewGroup

  * 自定义View又分为两种：在已有控件的基础上进行继承与修改，比如 CustomView extends TextView ，一个是直接继承View

  1. CustomView extends TextView
  2. CustomView extends View

  * 同样自定义ViewGroup也分为两种：在已有的控件容器中进行继承与修改，比如 CustomViewGroup extends Linearlayout，一个是直接继承ViewGroup

  1. CustomViewGroup extends Linearlayout
  2. CustomViewGroup extends ViewGroup

### 实现的步骤与方法

实现一个自定义View（非ViewGroup），就好比画画，首先你需要去测量，告诉系统这个控件是多大，其width为多少，height为多少

测量之后，需要去布局，这幅画显示在纸上的哪个位置，测量和布局结束之后才能去绘制，去给你的画上色。其实这就是一个自定义View实现的基本步骤：

  onMeasure() => onLayout() => onDraw();

  * onMeasure() 测量

          @Override
          protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
            super.onMeasure(widthMeasureSpec, heightMeasureSpec);
          }

  该方法有两个参数，widthMeasureSpec和heightMeasureSpec，这两个参数其实就是你在xml文件中赋予给该View的layout_width以及layout_height的值。

然后系统会调用onMeasure(widthMeasureSpec, heightMeasureSpec)方法得到测量的值。这里又要扯到View的测量模式:

  | LayoutParams | SpecMode  | SpecSize  |
  | -------------|:---------:| ---------:|
  | wrap_content | AT_MOST   | SpecSize  |
  | match_parent | EXACTLY   | ParentSize|
  | 45dp         | EXACTLY   |    45dp   |

如上表所示：测量模式由LayoutParams决定，即layout_width与layout_height的值决定：
上表中还缺少一个模式UNSPECIFIED(很少用到)

***
  1. **UNSPECIFIED**：
  *父容器不对View有任何的限制，要多大给多大，这种情况一般用于系统内部，表示一种测量的状态*

***
  2. **EXACTLY**:
  *父容器已经检测出View的精确大小，这个时候View的最终大小就是SpecSize的值，对应于LayoutParams中
  的match_parent和具体的数值如45dp*

***
  3. **AT_MOST**:
  *父容器指定了一个可用大小即SpecSize，View的大小不能大于这个值，具体是什么值要看这个View的具体实现，对应于
  LayoutParams中的wrap_content*
